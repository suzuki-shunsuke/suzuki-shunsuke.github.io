<!DOCTYPE html>
<html lang="en">

  <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
		<title>
				durl - 壊れたURLを検知するCLIツール &middot; melody
		</title>
	
		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
	
		
		<link rel="icon" type="image/png" sizes="32x32" href="https://suzuki-shunsuke.github.io/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="https://suzuki-shunsuke.github.io/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="https://suzuki-shunsuke.github.io/images/apple-touch-icon.png">
	
		
		<link href="" rel="alternate" type="application/rss+xml" title="melody" />
	</head>
	

  <body>
		<nav class="nav">
			<div class="nav-container">
			<a href="https://suzuki-shunsuke.github.io/">
				<h2 class="nav-title">melody</h2>
			</a>
			<ul>
				<li><a href="https://suzuki-shunsuke.github.io/about">About</a></li>
				<li><a href="https://suzuki-shunsuke.github.io/">Posts</a></li>
			</ul>
			</div>
		</nav>


<main>
	<div class="post">
		<div class="post-info">
		<span>Written by</span>
			
			<br>
			<span>on&nbsp;</span><time datetime="2019-04-28 21:25:00 &#43;0900 &#43;0900">April 28, 2019</time>
		</div>

		<h1 class="post-title">durl - 壊れたURLを検知するCLIツール</h1>
		<div class="post-line"></div>

		

<p>結構前に開発したツールですが、まだ記事にしてなかったので紹介します。</p>

<p><a href="https://github.com/suzuki-shunsuke/durl">https://github.com/suzuki-shunsuke/durl</a></p>

<p>ファイル中の URL が壊れていないかチェックするツールです。
ファイル中の URL を抽出し、HTTPリクエストを投げてステータスコードが 2xx でないものがあった場合、異常終了します。</p>

<p>なお、ページ内リンク(アンカー)が壊れているものについては検知できません。</p>

<h2 id="インストール">インストール</h2>

<p>Go製で、バイナリを GitHub Releases で公開しています。</p>

<p><a href="https://github.com/suzuki-shunsuke/durl/releases">https://github.com/suzuki-shunsuke/durl/releases</a></p>

<h2 id="docker-イメージ">Docker イメージ</h2>

<p><a href="https://quay.io/repository/suzuki_shunsuke/durl">https://quay.io/repository/suzuki_shunsuke/durl</a></p>

<p>busybox ベースの Docker イメージも提供しています。
CI で使うのに便利です。</p>

<h2 id="使い方">使い方</h2>

<p><code>durl init</code> で設定ファイル <code>.durl.yml</code> を生成します。</p>

<pre><code>$ durl init
</code></pre>

<p><code>durl check</code> に対象ファイルパスのリストを標準入力として渡してください。
<code>find</code> コマンドなどと組み合わせると良いです。</p>

<p><a href="https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/scripts/durl.sh#L9">https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/scripts/durl.sh#L9</a></p>

<pre><code>find . \
  -type d -name node_modules -prune -o \
  -type d -name .git -prune -o \
  -type d -name vendor -prune -o \
  -type f -print | \
  grep -v package-lock.json | \
  grep -v Gopkg.toml | \
  grep -v Gopkg.lock | \
  durl check || exit 1
</code></pre>

<p>壊れた URL が見つかったら ファイルのパス、URL、HTTPのステータスコードを標準エラー出力します。</p>

<pre><code>$ echo bar.txt | durl check
[bar.txt] https://github.com/suzuki-shunsuke/dead-repository is dead (404)
</code></pre>

<h2 id="無視するドメイン">無視するドメイン</h2>

<p><a href="https://github.com/suzuki-shunsuke/durl/issues/11">https://github.com/suzuki-shunsuke/durl/issues/11</a></p>

<p>これらは無視します。</p>

<ul>
<li>example.com, example.org, example.net</li>
<li>localhost</li>
</ul>

<h2 id="設定">設定</h2>

<p><a href="https://github.com/suzuki-shunsuke/durl#configuration">https://github.com/suzuki-shunsuke/durl#configuration</a></p>

<ul>
<li>ignore_urls: 無視するURL(完全一致)のリスト</li>
<li>ignore_hosts: 無視するドメイン(完全一致)のリスト</li>
<li>http_method: HTTPリクエストのメソッド

<ul>
<li>head,get: HEADリクエストに失敗したらGETリクエスト</li>
<li>head: HEADリクエスト</li>
<li>get: GETリクエスト</li>
</ul></li>
<li>max_request_count: 同時に並列でリクエストする最大数</li>
<li>max_failed_request_count: 最大の失敗URL数。これを超えると即時異常終了する</li>
<li>http_request_timeout: HTTPリクエストのタイムアウト</li>
</ul>

<h2 id="ci-に組み込む">CI に組み込む</h2>

<p>ドキュメントやブログをGitHubなどでホスティングしている場合、CIに組み込むことも出来ます。</p>

<ul>
<li><a href="https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/.drone.yml#L35-L38">https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/.drone.yml#L35-L38</a></li>
<li><a href="https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/scripts/durl.sh#L9">https://github.com/suzuki-shunsuke/go-errlog/blob/v0.9.0/scripts/durl.sh#L9</a></li>
</ul>


	</div>

	<div class="pagination">
		<a href="/2019-knowledge-share-meeting/" class="left arrow">&#8592;</a>
		<a href="/go-jsoneq/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>		<footer>
			<span>
			&copy; <time datetime="2019-06-12 02:45:25.689426291 &#43;0000 UTC m=&#43;0.064332645">2019</time> . Made with Hugo using the <a href="https://github.com/EmielH/tale-hugo/">Tale</a> theme.
			</span>
		</footer>
  </body>
</html>